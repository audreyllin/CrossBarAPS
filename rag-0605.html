<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CROSSBAR | Audrey AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #FF8C00;  /* Warm orange */
            --primary-light: #FFA726;
            --primary-dark: #EF6C00;
            --text: #333333;
            --bg: #FFF8F0;       /* Soft yellow-orange */
            --card-bg: #FFFFFF;
            --border: #E0E0E0;
            --success: #4CAF50;
            --error: #F44336;
            --info: #2196F3;
            --doc-purple: #7E57C2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        /* Header styles */
        header {
            background-color: var(--card-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 0.8rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary-dark);
        }
        
        .logo-icon {
            background: var(--primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        nav ul {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }
        
        nav a {
            text-decoration: none;
            color: var(--text);
            font-weight: 500;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        nav a:hover {
            color: var(--primary);
        }
        
        /* Main chat container */
        .main-container {
            display: flex;
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            padding: 1rem;
            gap: 1.5rem;
        }
        
        .knowledge-panel {
            width: 300px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            height: fit-content;
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.2rem;
            color: var(--primary-dark);
        }
        
        .active-docs {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .doc-item {
            display: flex;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
            gap: 0.8rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .doc-item:hover {
            background: rgba(255, 140, 0, 0.05);
        }
        
        .doc-item.active {
            background: rgba(255, 140, 0, 0.1);
            border-left: 3px solid var(--primary);
            padding-left: 0.5rem;
        }
        
        .doc-icon {
            width: 36px;
            height: 36px;
            background: var(--doc-purple);
            color: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-container {
            flex: 1;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .assistant-title {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .avatar {
            background-color: white;
            color: var(--primary);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .language-selector {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .message {
            max-width: 85%;
            padding: 1.2rem;
            border-radius: 12px;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        
        .bot-message {
            background: #f8f8f8;
            align-self: flex-start;
            border-top-left-radius: 4px;
        }
        
        .user-message {
            background: var(--primary-light);
            color: white;
            align-self: flex-end;
            border-top-right-radius: 4px;
        }
        
        .upload-message {
            background: #f0f7ff;
            border-left: 4px solid var(--info);
            padding: 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
        }
        
        .upload-message.success {
            border-left-color: var(--success);
        }
        
        .upload-message.error {
            border-left-color: var(--error);
        }
        
        .message-content {
            margin-bottom: 0.5rem;
        }
        
        .message-metadata {
            font-size: 0.8rem;
            color: #777;
            display: flex;
            justify-content: flex-end;
            margin-top: 0.5rem;
        }
        
        .feedback {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .feedback-btn {
            background: rgba(0,0,0,0.05);
            border: none;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: background 0.2s;
        }
        
        .feedback-btn:hover {
            background: rgba(0,0,0,0.1);
        }
        
        .docs-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }
        
        .translation-option {
            font-size: 0.85rem;
            color: var(--primary);
            cursor: pointer;
            margin-top: 0.5rem;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .user-input-area {
            padding: 1.2rem;
            border-top: 1px solid var(--border);
            background: var(--card-bg);
        }
        
        .input-options {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }
        
        .input-btn {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .input-btn:hover {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }
        
        .user-input {
            display: flex;
            gap: 0.8rem;
        }
        
        .user-input input {
            flex: 1;
            padding: 0.9rem 1.2rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .user-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.2);
        }
        
        .send-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 1.8rem;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: background 0.2s;
        }
        
        .send-btn:hover {
            background: var(--primary-dark);
        }
        
        .hidden {
            display: none;
        }
        
        #file-upload {
            width: 0.1px;
            height: 0.1px;
            opacity: 0;
            overflow: hidden;
            position: absolute;
            z-index: -1;
        }
        
        .file-upload-label {
            display: inline-block;
            cursor: pointer;
        }
        
        /* Footer */
        footer {
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            padding: 1.5rem;
            text-align: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: auto;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 0.8rem;
        }
        
        .footer-links a {
            color: var(--text);
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .footer-links a:hover {
            color: var(--primary);
        }
        
        /* Responsive design */
        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
            }
            
            .knowledge-panel {
                width: 100%;
            }
            
            .message {
                max-width: 90%;
            }
        }
        
        @media (max-width: 600px) {
            header {
                flex-direction: column;
                gap: 1rem;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .user-input {
                flex-direction: column;
            }
            
            .send-btn {
                width: 100%;
                padding: 0.8rem;
            }
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        .context-indicator {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .follow-up-suggestion {
            background: #f0f7ff;
            border-left: 3px solid var(--info);
            padding: 0.8rem;
            margin-top: 0.8rem;
            border-radius: 0 8px 8px 0;
        }
        
        .suggestion-title {
            font-weight: 500;
            margin-bottom: 0.3rem;
        }
        
        .suggestion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .suggestion-item {
            background: rgba(33, 150, 243, 0.1);
            color: var(--info);
            border-radius: 16px;
            padding: 0.3rem 0.8rem;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .suggestion-item:hover {
            background: var(--info);
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <span>CROSSBAR</span>
        </div>
        <nav>
            <ul>
                <li><a href="#"><i class="fas fa-newspaper"></i> News</a></li>
                <li><a href="#"><i class="fas fa-code"></i> Developer Portal</a></li>
                <li><a href="#" class="active"><i class="fas fa-robot"></i> Ask Audrey</a></li>
                <li><a href="#"><i class="fas fa-road"></i> Dev Tracks</a></li>
                <li><a href="#"><i class="fas fa-book"></i> Documentation</a></li>
                <li><a href="#"><i class="fab fa-github"></i> GitHub</a></li>
                <li><a href="#"><i class="fab fa-discord"></i> Discord</a></li>
            </ul>
        </nav>
    </header>
    
    <div class="main-container">
        <div class="knowledge-panel">
            <div class="panel-header">
                <i class="fas fa-lightbulb"></i>
                <h3>Conversation Context</h3>
            </div>
            <p>Audrey maintains context for follow-up questions. Current focus:</p>
            <div id="context-display" style="margin-top: 0.8rem; background: #f8f8f8; padding: 1rem; border-radius: 8px;">
                <p><i class="fas fa-info-circle"></i> No active context</p>
            </div>
            
            <div class="panel-header" style="margin-top: 1.5rem;">
                <i class="fas fa-file-alt"></i>
                <h3>Active Documents</h3>
            </div>
            <div class="active-docs" id="active-docs">
                <div class="doc-item active" data-doc="company">
                    <div class="doc-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div>
                        <div>www.crossbar-inc.com</div>
                        <small>Company website</small>
                    </div>
                </div>
            </div>
            
            <div class="panel-header" style="margin-top: 1.5rem;">
                <i class="fas fa-bolt"></i>
                <h3>Quick Actions</h3>
            </div>
            <button class="input-btn" style="width: 100%; margin-top: 0.5rem;" onclick="resetConversation()">
                <i class="fas fa-sync-alt"></i> Reset Conversation
            </button>
        </div>
        
        <div class="chat-container">
            <div class="chat-header">
                <div class="assistant-title">
                    <div class="avatar">A</div>
                    <div>
                        <h2>Audrey AI Assistant</h2>
                        <small>Specialized in CROSSBAR products and crypto security</small>
                    </div>
                </div>
                <select class="language-selector" id="language-selector">
                    <option value="auto">🌐 Auto-detect</option>
                    <option value="en">🇺🇸 English</option>
                    <option value="zh">🇨🇳 中文 (Chinese)</option>
                    <option value="es">🇪🇸 Español (Spanish)</option>
                    <option value="fr">🇫🇷 Français (French)</option>
                </select>
            </div>
            
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    <div class="message-content">
                        <strong>Hello, I'm Audrey, your CROSSBAR AI Assistant.</strong>
                        <p>I specialize in CROSSBAR products and crypto wallet security. Here's what I can help with:</p>
                        <ul>
                            <li>Answer questions about CROSSBAR hardware and software</li>
                            <li>Analyze documents (PDF, TXT, DOCX) using our RAG system</li>
                            <li>Maintain context for follow-up questions</li>
                            <li>Communicate in multiple languages</li>
                        </ul>
                        <p>Try asking about post-quantum signature schemes or upload a document!</p>
                    </div>
                    <div class="message-metadata">
                        Just now
                    </div>
                </div>
            </div>
            
            <div class="user-input-area">
                <div class="input-options">
                    <button class="input-btn" id="upload-btn">
                        <i class="fas fa-file-upload"></i> Upload Document
                    </button>
                    <button class="input-btn" id="paste-link-btn">
                        <i class="fas fa-link"></i> Paste Link
                    </button>
                    <button class="input-btn" id="company-info-btn">
                        <i class="fas fa-building"></i> Company Info
                    </button>
                    <input type="file" id="file-upload" accept=".pdf,.txt,.docx,.md">
                </div>
                
                <div class="user-input">
                    <input type="text" id="user-input" placeholder="Ask about post-quantum signature schemes or upload documents...">
                    <button class="send-btn" id="send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="footer-links">
            <a href="#">Legal</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms</a>
            <a href="https://www.crossbar-inc.com/company/contact/" target="_blank">Contact</a>
        </div>
        <p>© 2025 CROSSBAR Inc. All rights reserved.</p>
        <p><small>"Audrey" is a proprietary AI for CROSSBAR developers, powered by advanced RAG systems.</small></p>
    </footer>

    <script>
        // DOM Elements
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const uploadBtn = document.getElementById('upload-btn');
        const fileUpload = document.getElementById('file-upload');
        const pasteLinkBtn = document.getElementById('paste-link-btn');
        const companyInfoBtn = document.getElementById('company-info-btn');
        const languageSelector = document.getElementById('language-selector');
        const activeDocs = document.getElementById('active-docs');
        const contextDisplay = document.getElementById('context-display');
        
        // App state
        let currentContext = {
            activeDocument: "www.crossbar-inc.com",
            lastTopic: "CROSSBAR products",
            conversationHistory: [],
            lastResponseType: null
        };
        
        // Initialize event listeners
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        
        uploadBtn.addEventListener('click', () => fileUpload.click());
        pasteLinkBtn.addEventListener('click', promptForLink);
        companyInfoBtn.addEventListener('click', fetchCompanyInfo);
        fileUpload.addEventListener('change', handleFileUpload);
        
        // Initialize with company website info
        updateContextDisplay();
        
        function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addMessage('user', message);
            userInput.value = '';
            
            // Update conversation history
            currentContext.conversationHistory.push({ role: 'user', content: message });
            
            // Show typing indicator
            const typingIndicator = showTypingIndicator();
            
            // Simulate processing delay
            setTimeout(() => {
                // Remove typing indicator
                chatMessages.removeChild(typingIndicator);
                
                // Generate response
                const response = generateResponse(message);
                addMessage('bot', response);
                
                // Update context with last response type
                currentContext.lastResponseType = response.type;
                currentContext.conversationHistory.push({ role: 'assistant', content: response.text });
                
                // Update context display
                updateContextDisplay();
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        }
        
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message';
            typingDiv.innerHTML = `
                <div class="message-content">
                    <div class="pulse" style="display: flex; gap: 0.5rem; align-items: center;">
                        <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%;"></div>
                        <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%;"></div>
                        <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%;"></div>
                        <span>Audrey is thinking...</span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingDiv;
        }
        
        function addMessage(sender, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            if (sender === 'bot') {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        ${content.text}
                    </div>
                    ${content.type !== 'status' ? `
                    <div class="feedback">
                        <button class="feedback-btn" onclick="rateResponse(this, true)">
                            <i class="fas fa-thumbs-up"></i> Helpful
                        </button>
                        <button class="feedback-btn" onclick="rateResponse(this, false)">
                            <i class="fas fa-thumbs-down"></i> Not helpful
                        </button>
                    </div>
                    ` : ''}
                    <div class="message-metadata">
                        ${timeString}
                    </div>
                `;
                
                // Add follow-up suggestions for document responses
                if (content.type === 'document' && content.suggestions) {
                    messageDiv.innerHTML += `
                        <div class="follow-up-suggestion">
                            <div class="suggestion-title">Follow-up suggestions:</div>
                            <div class="suggestion-list">
                                ${content.suggestions.map(s => `<div class="suggestion-item" onclick="followUpSuggestion('${s}')">${s}</div>`).join('')}
                            </div>
                        </div>
                    `;
                }
            } else {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <strong>${content}</strong>
                    </div>
                    <div class="message-metadata">
                        ${timeString}
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            const validTypes = [
                'application/pdf', 
                'text/plain', 
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'application/msword'
            ];
            
            if (!validTypes.includes(file.type)) {
                showUploadMessage(`❌ Unsupported file type: ${file.name}`, false);
                return;
            }
            
            // Simulate upload processing
            showUploadMessage(`⏳ Processing "${file.name}" using our RAG system...`, true);
            
            setTimeout(() => {
                // Add to active documents
                addActiveDocument(file.name, 'file');
                
                // Set as active context
                currentContext.activeDocument = file.name;
                currentContext.lastTopic = file.name;
                updateContextDisplay();
                
                // Show success message
                showUploadMessage(`✅ Document processed successfully! You can now ask questions about "${file.name}"`, true);
                addMessage('bot', {
                    text: `I've processed your document <strong>${file.name}</strong>. You can now ask me questions about its content.`,
                    type: 'status'
                });
                
                // Clear file input
                event.target.value = '';
            }, 2000);
        }
        
        function addActiveDocument(name, type) {
            const docItem = document.createElement('div');
            docItem.className = 'doc-item';
            docItem.dataset.doc = name;
            
            const icon = type === 'file' ? 'fa-file-pdf' : 'fa-globe';
            const typeText = type === 'file' ? 'Document' : 'Website';
            
            docItem.innerHTML = `
                <div class="doc-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div>
                    <div>${name}</div>
                    <small>${typeText}</small>
                </div>
            `;
            
            // Add click handler to set active document
            docItem.addEventListener('click', () => {
                document.querySelectorAll('.doc-item').forEach(item => {
                    item.classList.remove('active');
                });
                docItem.classList.add('active');
                currentContext.activeDocument = name;
                currentContext.lastTopic = name;
                updateContextDisplay();
                addMessage('bot', {
                    text: `Now focusing on <strong>${name}</strong>. Ask me anything about this document.`,
                    type: 'status'
                });
            });
            
            activeDocs.appendChild(docItem);
        }
        
        function promptForLink() {
            const url = prompt('Enter URL of document to analyze:', 'https://arxiv.org/pdf/2307.12874');
            if (!url) return;
            
            // Validate URL
            if (!url.startsWith('http')) {
                showUploadMessage('❌ Please enter a valid URL starting with http:// or https://', false);
                return;
            }
            
            showUploadMessage(`⏳ Processing document from ${url}...`, true);
            
            setTimeout(() => {
                // Add to active documents
                const domain = new URL(url).hostname;
                addActiveDocument(domain, 'link');
                
                // Set as active context
                currentContext.activeDocument = url;
                currentContext.lastTopic = domain;
                updateContextDisplay();
                
                // Show success message
                showUploadMessage(`✅ Successfully analyzed document from ${url}`, true);
                addMessage('bot', {
                    text: `I've processed the document from <a href="${url}" target="_blank" class="docs-link">${url}</a>. Ask me questions about its content.`,
                    type: 'status'
                });
            }, 2500);
        }
        
        function fetchCompanyInfo() {
            showUploadMessage(`⏳ Retrieving company information from CROSSBAR website...`, true);
            
            setTimeout(() => {
                // Simulated company data
                const companyInfo = {
                    name: "CROSSBAR Inc.",
                    founded: "2020",
                    headquarters: "San Francisco, CA",
                    ceo: "Alex Morgan",
                    contact: "contact@crossbar-inc.com",
                    website: "https://www.crossbar-inc.com"
                };
                
                const response = `
                    <strong>Company Information:</strong>
                    <div style="margin-top: 0.8rem; background: #f8f8f8; padding: 1rem; border-radius: 8px;">
                        <p><strong>Name:</strong> ${companyInfo.name}</p>
                        <p><strong>Founded:</strong> ${companyInfo.founded}</p>
                        <p><strong>Headquarters:</strong> ${companyInfo.headquarters}</p>
                        <p><strong>CEO:</strong> ${companyInfo.ceo}</p>
                        <p><strong>Contact:</strong> <a href="mailto:${companyInfo.contact}" class="docs-link">${companyInfo.contact}</a></p>
                        <p><strong>Website:</strong> <a href="${companyInfo.website}" target="_blank" class="docs-link">${companyInfo.website}</a></p>
                    </div>
                    <p style="margin-top: 0.8rem;">For more details, visit our <a href="https://www.crossbar-inc.com/company/contact/" target="_blank" class="docs-link">contact page</a>.</p>
                `;
                
                addMessage('bot', {
                    text: response,
                    type: 'company'
                });
                
                // Update context
                currentContext.lastTopic = "CROSSBAR company information";
                updateContextDisplay();
            }, 1500);
        }
        
        function showUploadMessage(text, isSuccess) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `upload-message ${isSuccess ? 'success' : 'error'}`;
            msgDiv.textContent = text;
            chatMessages.appendChild(msgDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function generateResponse(query) {
            const lang = languageSelector.value;
            const isFollowUp = currentContext.conversationHistory.length > 1 && 
                              (query.toLowerCase().includes('it') || 
                               query.toLowerCase().includes('that') || 
                               query.length < 20);
            
            // Handle follow-up questions based on last response
            if (isFollowUp && currentContext.lastResponseType) {
                switch(currentContext.lastResponseType) {
                    case 'document':
                        return documentQuestionResponse(query, currentContext.activeDocument, true);
                    case 'crypto':
                        return cryptoResponse(query, true);
                    case 'crossbar':
                        return crossbarResponse(query, true);
                    default:
                        // Continue to normal processing
                }
            }
            
            // Handle document-specific questions
            if (currentContext.activeDocument) {
                if (query.toLowerCase().includes('summary') || query.toLowerCase().includes('summarize')) {
                    return documentSummaryResponse(currentContext.activeDocument);
                }
                
                if (query.toLowerCase().includes('key feature') || 
                    query.toLowerCase().includes('main point') ||
                    query.toLowerCase().includes('important')) {
                    return documentKeyFeaturesResponse(currentContext.activeDocument);
                }
                
                if (currentContext.activeDocument.includes('crossbar-inc.com')) {
                    return companyInfoResponse(query);
                }
                
                // General document question
                return documentQuestionResponse(query, currentContext.activeDocument);
            }
            
            // Handle general CROSSBAR questions
            if (query.toLowerCase().includes('crossbar')) {
                return crossbarResponse(query);
            }
            
            // Handle crypto wallet questions
            if (query.toLowerCase().includes('wallet') || 
                query.toLowerCase().includes('crypto') ||
                query.toLowerCase().includes('blockchain') ||
                query.toLowerCase().includes('quantum')) {
                return cryptoResponse(query);
            }
            
            // Default response
            return {
                text: `🔍 I specialize in CROSSBAR products and crypto wallet security. ` +
                      `Please ask questions related to these topics, or upload a document to analyze.`,
                type: 'default'
            };
        }
        
        function documentSummaryResponse(document) {
            let response = '';
            
            if (document.includes('arxiv')) {
                response = `
                    <strong>Document Summary:</strong>
                    <p>The paper "Quantum-Resistant Cryptographic Algorithms for Hardware Wallets" discusses:</p>
                    <ul>
                        <li>Evaluation of post-quantum signature schemes (CRYSTALS-Dilithium, Falcon, SPHINCS+)</li>
                        <li>Performance benchmarks on embedded hardware</li>
                        <li>Security analysis against quantum attacks</li>
                        <li>Implementation recommendations for hardware wallets</li>
                    </ul>
                    <p>The authors conclude that lattice-based schemes offer the best balance of security and performance for future hardware wallets.</p>
                    <p><a href="https://arxiv.org/pdf/2307.12874" target="_blank" class="docs-link">View full paper</a></p>
                `;
            } else {
                response = `
                    <strong>Document Summary:</strong>
                    <p>Based on my analysis of ${document}, the key points are:</p>
                    <ul>
                        <li>Hardware wallet security architecture</li>
                        <li>Multi-signature transaction workflows</li>
                        <li>Secure element technology specifications</li>
                        <li>Implementation of quantum-resistant algorithms</li>
                        <li>Compliance with FIPS 140-3 standards</li>
                    </ul>
                    <p>Would you like more details on any specific section?</p>
                `;
            }
            
            return {
                text: response,
                type: 'document',
                suggestions: [
                    'Key features?',
                    'Security recommendations?',
                    'Performance metrics?',
                    'Implementation challenges?'
                ]
            };
        }
        
        function documentKeyFeaturesResponse(document) {
            const response = `
                <strong>Key Features from ${document}:</strong>
                <div style="margin-top: 0.8rem; background: #f8f8f8; padding: 1rem; border-radius: 8px;">
                    <p>1. <strong>Advanced Secure Element:</strong> Military-grade EAL6+ certified chip</p>
                    <p>2. <strong>Quantum-Resistant Algorithms:</strong> CRYSTALS-Dilithium implementation</p>
                    <p>3. <strong>Multi-Party Computation:</strong> Distributed key generation for enhanced security</p>
                    <p>4. <strong>Biometric Authentication:</strong> Integrated fingerprint scanner</p>
                    <p>5. <strong>Cross-Chain Support:</strong> Compatible with 50+ blockchain networks</p>
                </div>
                <p class="translation-option" onclick="translateResponse(this, '${languageSelector.value}')">
                    <i class="fas fa-language"></i> Translate to ${getLanguageName(languageSelector.value)}
                </p>
            `;
            
            return {
                text: response,
                type: 'document',
                suggestions: [
                    'How does biometric auth work?',
                    'Quantum-resistant details?',
                    'Cross-chain compatibility?',
                    'Performance benchmarks?'
                ]
            };
        }
        
        function documentQuestionResponse(query, document, isFollowUp = false) {
            let answer = '';
            
            if (isFollowUp) {
                // Handle follow-up based on previous document context
                if (query.toLowerCase().includes('quantum') || query.toLowerCase().includes('crypto')) {
                    answer = `
                        <p>Following up on quantum-resistant signatures:</p>
                        <p>Post-quantum signature schemes are cryptographic algorithms designed to be secure against attacks by quantum computers. The three main approaches are:</p>
                        <ol>
                            <li><strong>Lattice-based (e.g., CRYSTALS-Dilithium):</strong> Based on the hardness of lattice problems, offering a balance of security and performance.</li>
                            <li><strong>Hash-based (e.g., SPHINCS+):</strong> Rely on cryptographic hash functions, providing strong security guarantees but larger signature sizes.</li>
                            <li><strong>Multivariate (e.g., Rainbow):</strong> Based on the difficulty of solving systems of multivariate polynomial equations.</li>
                        </ol>
                        <p>CROSSBAR implements lattice-based schemes as they provide the best performance-security tradeoff for embedded devices.</p>
                    `;
                } else {
                    answer = `
                        <p>Building on our previous discussion about ${currentContext.lastTopic}:</p>
                        <p>${getDocumentAnswer(query, document)}</p>
                    `;
                }
            } else {
                answer = `
                    <p>${getDocumentAnswer(query, document)}</p>
                `;
            }
            
            const response = `
                <strong>Regarding ${document}:</strong>
                ${answer}
                <p>This analysis is based on our RAG system processing of the document content.</p>
            `;
            
            return {
                text: response,
                type: 'document',
                suggestions: [
                    'How does this compare to traditional schemes?',
                    'Implementation in CROSSBAR?',
                    'Performance impact?',
                    'Security tradeoffs?'
                ]
            };
        }
        
        function getDocumentAnswer(query, document) {
            if (query.toLowerCase().includes('post-quantum') || query.toLowerCase().includes('quantum-resistant')) {
                return `Post-quantum signature schemes are cryptographic algorithms designed to be secure against attacks by quantum computers. The paper discusses three main candidates for hardware wallet implementation: lattice-based CRYSTALS-Dilithium, hash-based SPHINCS+, and Falcon. CRYSTALS-Dilithium offers the best balance of security and performance for embedded devices like CROSSBAR wallets.`;
            }
            
            const answers = {
                "summary": `The document provides a comprehensive overview of hardware wallet security, focusing on quantum-resistant algorithms and secure element implementations.`,
                "key feature": `The most significant innovation in the document is the implementation of lattice-based cryptography for quantum resistance without compromising performance.`,
                "quantum": `The paper discusses three quantum-resistant algorithms suitable for hardware wallets: CRYSTALS-Dilithium, Falcon, and SPHINCS+.`,
                "security": `Security measures include multi-factor authentication, tamper-resistant hardware, and air-gapped transaction signing.`
            };
            
            for (const [key, answer] of Object.entries(answers)) {
                if (query.toLowerCase().includes(key)) {
                    return answer;
                }
            }
            
            return `Based on my analysis of ${document}, ${getRandomAnswer()}`;
        }
        
        function updateContextDisplay() {
            let contextHTML = '';
            
            if (currentContext.activeDocument) {
                contextHTML = `
                    <p><i class="fas fa-file-alt"></i> Active document: <strong>${currentContext.activeDocument}</strong></p>
                    <p><i class="fas fa-comment"></i> Last topic: <strong>${currentContext.lastTopic}</strong></p>
                    <div class="context-indicator">
                        <i class="fas fa-sync-alt"></i> Context maintained for follow-up questions
                    </div>
                `;
            } else {
                contextHTML = `
                    <p><i class="fas fa-info-circle"></i> No active document context</p>
                    <p><i class="fas fa-comment"></i> Last topic: <strong>${currentContext.lastTopic || 'None'}</strong></p>
                `;
            }
            
            contextDisplay.innerHTML = contextHTML;
        }
        
        // Helper functions
        function getRandomAnswer() {
            const answers = [
                "the document emphasizes the importance of secure key management in hardware wallets.",
                "a key finding is that lattice-based cryptography offers the best performance-security tradeoff for embedded devices.",
                "the research demonstrates a 40% improvement in signature speed compared to traditional methods.",
                "the authors recommend using multi-party computation for high-value transactions."
            ];
            return answers[Math.floor(Math.random() * answers.length)];
        }
        
        function getLanguageName(code) {
            const languages = {
                'en': 'English',
                'zh': 'Chinese',
                'es': 'Spanish',
                'fr': 'French',
                'de': 'German',
                'ja': 'Japanese'
            };
            return languages[code] || 'English';
        }
        
        // UI interaction functions
        window.rateResponse = function(button, isHelpful) {
            if (isHelpful) {
                button.innerHTML = '<i class="fas fa-check"></i> Thank you!';
                button.style.background = 'var(--success)';
                button.style.color = 'white';
            } else {
                button.innerHTML = '<i class="fas fa-times"></i> Noted';
                button.style.background = 'var(--error)';
                button.style.color = 'white';
            }
            button.disabled = true;
        };
        
        window.followUpSuggestion = function(question) {
            userInput.value = question;
            sendMessage();
        };
        
        function resetConversation() {
            if (confirm("Are you sure you want to reset the conversation? This will clear the chat history.")) {
                chatMessages.innerHTML = `
                    <div class="message bot-message">
                        <div class="message-content">
                            <strong>Hello, I'm Audrey, your CROSSBAR AI Assistant.</strong>
                            <p>Our conversation has been reset. How can I help you today?</p>
                        </div>
                        <div class="message-metadata">
                            Just now
                        </div>
                    </div>
                `;
                currentContext = {
                    activeDocument: "www.crossbar-inc.com",
                    lastTopic: "CROSSBAR products",
                    conversationHistory: [],
                    lastResponseType: null
                };
                updateContextDisplay();
            }
        }
        
        // Initialize with an example conversation
        setTimeout(() => {
            addMessage('user', 'What are post-quantum signature schemes?');
            setTimeout(() => {
                addMessage('bot', {
                    text: documentQuestionResponse('What are post-quantum signature schemes?', 'arXiv Paper').text,
                    type: 'document',
                    suggestions: [
                        'How do they differ from traditional schemes?',
                        'Implementation in CROSSBAR?',
                        'Performance impact?',
                        'Security tradeoffs?'
                    ]
                });
                currentContext.lastTopic = "post-quantum signature schemes";
                currentContext.lastResponseType = 'document';
                updateContextDisplay();
            }, 500);
        }, 2000);
    </script>
</body>
</html>