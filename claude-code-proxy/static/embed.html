<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Presentation Generator - Secure API Integration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.11.0/dist/pptxgen.bundle.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f1a3d, #2a0c3d, #0f1a3d);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            background: rgba(15, 25, 60, 0.7);
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(106, 90, 205, 0.3);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at top right, rgba(106, 90, 205, 0.3), transparent 70%);
            z-index: -1;
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, #6a5acd, #9370db);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #a0a0e0;
            max-width: 700px;
            margin: 0 auto 30px;
        }

        .main-content {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }

        .input-section {
            flex: 1;
            background: rgba(20, 25, 50, 0.7);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(106, 90, 205, 0.3);
        }

        .preview-section {
            flex: 1;
            background: rgba(20, 25, 50, 0.7);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(106, 90, 205, 0.3);
            display: flex;
            flex-direction: column;
        }

        .section-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #9370db;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #a0a0e0;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(40, 40, 80, 0.5);
            border: 1px solid rgba(106, 90, 205, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            padding: 16px 40px;
            background: linear-gradient(45deg, #6a5acd, #9370db);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 5px 20px rgba(106, 90, 205, 0.5);
            width: 100%;
            justify-content: center;
        }

        .btn:hover {
            background: linear-gradient(45deg, #5a4acd, #8360db);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(106, 90, 205, 0.7);
        }

        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn i {
            font-size: 1.2rem;
        }

        .multimedia-upload {
            border: 2px dashed rgba(106, 90, 205, 0.5);
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .multimedia-upload:hover {
            border-color: #6a5acd;
            background: rgba(40, 40, 80, 0.3);
        }

        .multimedia-upload i {
            font-size: 3rem;
            color: #9370db;
            margin-bottom: 15px;
        }

        .multimedia-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .preview-item {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid #6a5acd;
            position: relative;
            background-size: cover;
            background-position: center;
        }

        .preview-item.video::before {
            content: '\f144';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5rem;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .preview-item.audio::before {
            content: '\f028';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5rem;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .preview-container {
            flex: 1;
            background: #111;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            min-height: 400px;
        }

        .slide-nav {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
        }

        .slide-nav-btn {
            background: rgba(40, 40, 80, 0.5);
            color: #ccc;
            border: none;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slide-nav-btn:hover {
            background: linear-gradient(45deg, #6a5acd, #9370db);
            color: white;
        }

        .slide-nav-btn:disabled {
            background: #333;
            color: #777;
            cursor: not-allowed;
        }

        .slide-counter {
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #a0a0e0;
        }

        .download-section {
            margin-top: 20px;
            text-align: center;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .save-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateX(200%);
            transition: transform 0.3s ease;
        }

        .save-notification.show {
            transform: translateX(0);
        }

        .save-notification i {
            font-size: 1.5rem;
        }

        .generating-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 20, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .generating-overlay.hidden {
            display: none;
        }

        .generating-overlay i {
            font-size: 3rem;
            color: #6a5acd;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .preview-placeholder {
            text-align: center;
            color: #a0a0e0;
            padding: 20px;
        }

        .preview-placeholder i {
            font-size: 5rem;
            margin-bottom: 20px;
            color: #6a5acd;
        }

        .slide-svg {
            width: 100%;
            height: 100%;
            background-color: white;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .template-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }

        .template-item {
            height: 80px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            overflow: hidden;
            position: relative;
            transition: all 0.2s ease;
        }

        .template-item:hover {
            transform: scale(1.05);
            border-color: rgba(106, 90, 205, 0.5);
        }

        .template-item.active {
            border-color: #6a5acd;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(106, 90, 205, 0.7);
        }

        .template-item .template-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 0.7rem;
            padding: 3px;
            text-align: center;
        }

        .slide-content {
            position: relative;
            z-index: 2;
        }

        .slide-media {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .slide-media img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .slide-media video {
            max-width: 100%;
            max-height: 100%;
        }

        .slide-media iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .multimedia-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .url-input-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .url-input-group input {
            flex: 1;
        }

        .url-input-group button {
            padding: 10px 15px;
            background: #6a5acd;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        footer {
            text-align: center;
            padding: 40px 0 20px;
            margin-top: 40px;
            color: #a0a0e0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(106, 90, 205, 0.3);
        }

        /* Template backgrounds */
        .professional-bg {
            background: linear-gradient(45deg, #1E3A8A, #3B82F6);
            font-family: 'Inter', Arial, sans-serif;
        }

        .creative-bg {
            background: linear-gradient(45deg, #6A5ACD, #9370DB);
            font-family: 'Inter', Georgia, serif;
        }

        .minimalist-bg {
            background: linear-gradient(45deg, #4B5563, #9CA3AF);
            font-family: 'Inter', Helvetica, sans-serif;
        }

        .tech-bg {
            background: linear-gradient(45deg, #0F766E, #14B8A6);
            font-family: 'Inter', Consolas, monospace;
        }

        .strategic-bg {
            background: linear-gradient(45deg, #0D47A1, #424242);
            font-family: 'Inter', Roboto, sans-serif;
        }

        .crypto-bg {
            background: linear-gradient(45deg, #0f0c29, #302b63, #24243e);
            font-family: 'Inter', Orbitron, sans-serif;
        }

        .api-info {
            background: rgba(40, 40, 80, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .api-info i {
            color: #6a5acd;
            margin-right: 5px;
        }

        .ai-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .ai-option {
            flex: 1;
            padding: 15px;
            background: rgba(40, 40, 80, 0.5);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .ai-option.active {
            border-color: #6a5acd;
            background: rgba(106, 90, 205, 0.2);
        }

        .ai-option:hover {
            background: rgba(106, 90, 205, 0.3);
        }

        .ai-logo {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .ai-name {
            font-weight: 600;
        }

        .download-btn {
            padding: 12px 25px;
            background: rgba(40, 40, 80, 0.5);
            color: #ccc;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .download-btn:hover {
            background: linear-gradient(45deg, #6a5acd, #9370db);
            color: white;
        }

        .slide-content {
            position: relative;
            z-index: 2;
            padding: 20px;
            height: 100%;
            overflow: auto;
        }

        .slide-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #1E3A8A;
        }

        .slide-bullet {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }

        .slide-bullet:before {
            content: "•";
            position: absolute;
            left: 0;
            color: #3B82F6;
            font-size: 20px;
        }

        /* Error display */
        .error-panel {
            background: rgba(255, 50, 50, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .error-title {
            color: #ff6b6b;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .error-details {
            font-size: 0.9rem;
            color: #ffa5a5;
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }

        /* Status panel */
        .status-panel {
            background: rgba(106, 90, 205, 0.2);
            border: 1px solid rgba(106, 90, 205, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .status-panel h3 {
            color: #9370db;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-panel p {
            margin-bottom: 5px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ok {
            background-color: #28a745;
        }

        .status-warning {
            background-color: #ffc107;
        }

        .status-error {
            background-color: #dc3545;
        }

        /* Font weight classes for Inter */
        .font-thin {
            font-weight: 100;
        }

        .font-extralight {
            font-weight: 200;
        }

        .font-light {
            font-weight: 300;
        }

        .font-regular {
            font-weight: 400;
        }

        .font-medium {
            font-weight: 500;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-extrabold {
            font-weight: 800;
        }

        .font-black {
            font-weight: 900;
        }

        /* Proxy status */
        .proxy-status {
            background: rgba(20, 25, 50, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(106, 90, 205, 0.3);
        }

        .proxy-status h3 {
            color: #9370db;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .proxy-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(106, 90, 205, 0.3);
        }

        .proxy-item:last-child {
            border-bottom: none;
        }

        .proxy-label {
            font-weight: 500;
        }

        .proxy-value {
            font-weight: 300;
            color: #a0a0e0;
        }

        .proxy-value.ok {
            color: #28a745;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1 class="font-extrabold">AI Presentation Generator</h1>
            <p class="subtitle">Secure API Integration - Create stunning presentations with Claude AI & Gemini</p>
        </header>

        <div class="proxy-status">
            <h3><i class="fas fa-shield-alt"></i> Secure API Proxy Status</h3>
            <div class="proxy-item">
                <span class="proxy-label">Claude API Proxy:</span>
                <span class="proxy-value ok">Active & Secure</span>
            </div>
            <div class="proxy-item">
                <span class="proxy-label">Gemini API Proxy:</span>
                <span class="proxy-value ok">Active & Secure</span>
            </div>
            <div class="proxy-item">
                <span class="proxy-label">API Key Protection:</span>
                <span class="proxy-value ok">Server-side Only</span>
            </div>
            <div class="proxy-item">
                <span class="proxy-label">CORS Protection:</span>
                <span class="proxy-value ok">Properly Configured</span>
            </div>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="section-header">
                    <h2>Create Your Presentation</h2>
                    <p>Enter your content and let AI generate your slides</p>
                </div>

                <div class="error-panel" id="error-panel" style="display: none;">
                    <h3 class="error-title"><i class="fas fa-exclamation-triangle"></i> API Error</h3>
                    <p id="error-message">An error occurred while generating your presentation.</p>
                    <div class="error-details" id="error-details"></div>
                </div>

                <div class="ai-selector">
                    <div class="ai-option active" data-ai="claude">
                        <div class="ai-logo"><i class="fas fa-robot"></i></div>
                        <div class="ai-name">Claude AI</div>
                    </div>
                    <div class="ai-option" data-ai="gemini">
                        <div class="ai-logo"><i class="fab fa-google"></i></div>
                        <div class="ai-name">Google Gemini</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="presentation-title"><i class="fas fa-heading"></i> Presentation Title</label>
                    <input type="text" id="presentation-title" placeholder="Enter presentation title"
                        value="Future of AI in Business">
                </div>

                <div class="form-group">
                    <label for="presentation-topic"><i class="fas fa-lightbulb"></i> Presentation Topic</label>
                    <textarea id="presentation-topic"
                        placeholder="Describe what your presentation should be about">Create a presentation about the future of AI in business. Include topics like automation, data analysis, customer experience, and ethical considerations. Use a professional design with modern visuals.</textarea>
                </div>

                <div class="form-group">
                    <label for="slide-count"><i class="fas fa-layer-group"></i> Number of Slides</label>
                    <select id="slide-count">
                        <option value="5">5 Slides</option>
                        <option value="8">8 Slides</option>
                        <option value="10" selected>10 Slides</option>
                        <option value="12">12 Slides</option>
                    </select>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-palette"></i> Presentation Template</label>
                    <div class="template-grid" id="template-grid">
                        <div class="template-item professional-bg active" data-style="professional">
                            <div class="template-name">Professional</div>
                        </div>
                        <div class="template-item creative-bg" data-style="creative">
                            <div class="template-name">Creative</div>
                        </div>
                        <div class="template-item minimalist-bg" data-style="minimalist">
                            <div class="template-name">Minimalist</div>
                        </div>
                        <div class="template-item tech-bg" data-style="tech">
                            <div class="template-name">Tech</div>
                        </div>
                        <div class="template-item strategic-bg" data-style="strategic">
                            <div class="template-name">Strategic</div>
                        </div>
                        <div class="template-item crypto-bg" data-style="crypto">
                            <div class="template-name">Crypto</div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-photo-video"></i> Add Multimedia Resources</label>
                    <div class="multimedia-upload" id="multimedia-upload">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Drag & drop images/videos/audio here or click to browse</p>
                        <input type="file" id="file-input" accept="image/*,video/*,audio/*" multiple
                            style="display: none;">
                    </div>

                    <div class="multimedia-controls">
                        <div class="url-input-group">
                            <input type="text" id="media-url" placeholder="Paste image, video or audio URL">
                            <button id="add-url-btn">Add URL</button>
                        </div>
                    </div>

                    <div class="multimedia-preview" id="multimedia-preview"></div>
                </div>

                <button class="btn" id="generate-btn">
                    <i class="fas fa-magic"></i> Generate Presentation
                </button>

                <div class="api-info">
                    <i class="fas fa-info-circle"></i> Secure API integration through proxy server
                </div>
            </div>

            <div class="preview-section">
                <div class="section-header">
                    <h2>Presentation Preview</h2>
                    <p>Your AI-generated slides will appear here</p>
                </div>

                <div class="preview-container">
                    <div class="generating-overlay hidden" id="generating-overlay">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Generating Your Presentation</h3>
                        <p>Using AI to create your slides...</p>
                        <div id="api-status">Initializing secure connection...</div>
                    </div>

                    <div class="preview-placeholder" id="preview-placeholder">
                        <i class="fas fa-file-powerpoint"></i>
                        <h3>No Presentation Generated Yet</h3>
                        <p>Click "Generate Presentation" to create your slides</p>
                    </div>

                    <div id="slide-container" class="hidden">
                        <div class="slide-media" id="slide-media"></div>
                        <div class="slide-content" id="slide-content">
                            <!-- Slide content will be generated here -->
                        </div>
                    </div>
                </div>

                <div class="slide-nav">
                    <button class="slide-nav-btn" id="prev-slide" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="slide-counter">
                        <span id="current-slide">0</span> / <span id="total-slides">0</span>
                    </div>
                    <button class="slide-nav-btn" id="next-slide" disabled>
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>

                <div class="download-section">
                    <button class="download-btn" id="download-ppt-btn">
                        <i class="fas fa-file-powerpoint"></i> PPTX
                    </button>
                    <button class="download-btn" id="download-pdf-btn">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="download-btn" id="download-html-btn">
                        <i class="fas fa-file-code"></i> HTML
                    </button>
                </div>
            </div>
        </div>

        <div class="save-notification" id="save-notification">
            <i class="fas fa-check-circle"></i>
            <div>
                <h3>Presentation Saved!</h3>
                <p>Check your "Downloads" folder for the file</p>
            </div>
        </div>

        <footer>
            <p>Secure API Integration | Multimedia Presentation Generator</p>
            <p>© 2023 AI Presentation Tools. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const multimediaUpload = document.getElementById('multimedia-upload');
        const fileInput = document.getElementById('file-input');
        const multimediaPreview = document.getElementById('multimedia-preview');
        const generateBtn = document.getElementById('generate-btn');
        const generatingOverlay = document.getElementById('generating-overlay');
        const previewPlaceholder = document.getElementById('preview-placeholder');
        const slideContent = document.getElementById('slide-content');
        const slideMedia = document.getElementById('slide-media');
        const prevSlideBtn = document.getElementById('prev-slide');
        const nextSlideBtn = document.getElementById('next-slide');
        const currentSlideEl = document.getElementById('current-slide');
        const totalSlidesEl = document.getElementById('total-slides');
        const saveNotification = document.getElementById('save-notification');
        const slideContainer = document.getElementById('slide-container');
        const templateItems = document.querySelectorAll('.template-item');
        const mediaUrlInput = document.getElementById('media-url');
        const addUrlBtn = document.getElementById('add-url-btn');
        const downloadPptBtn = document.getElementById('download-ppt-btn');
        const downloadPdfBtn = document.getElementById('download-pdf-btn');
        const downloadHtmlBtn = document.getElementById('download-html-btn');
        const aiOptions = document.querySelectorAll('.ai-option');
        const errorPanel = document.getElementById('error-panel');
        const errorMessage = document.getElementById('error-message');
        const errorDetails = document.getElementById('error-details');
        const apiStatus = document.getElementById('api-status');

        // State
        const state = {
            multimediaResources: [],
            currentSlideIndex: 0,
            generatedSlides: [],
            presentationData: null,
            selectedAI: 'claude'
        };

        // API Configuration
        const API_ENDPOINTS = {
            CLAUDE: "http://localhost:8082/v1/messages",
            GEMINI: "http://localhost:8082/v1/chat/completions"
        };

        // Style templates
        const styleTemplates = {
            professional: {
                bgColor: '#1E3A8A',
                textColor: '#FFFFFF',
                titleColor: '#FFFFFF',
                bulletColor: '#3B82F6',
                titleSize: 32,
                textSize: 20,
                font: 'Inter, Arial, sans-serif'
            },
            creative: {
                bgColor: '#6A5ACD',
                textColor: '#FFFFFF',
                titleColor: '#FFFFFF',
                bulletColor: '#9370DB',
                titleSize: 32,
                textSize: 20,
                font: 'Inter, Georgia, serif'
            },
            minimalist: {
                bgColor: '#4B5563',
                textColor: '#FFFFFF',
                titleColor: '#FFFFFF',
                bulletColor: '#9CA3AF',
                titleSize: 32,
                textSize: 20,
                font: 'Inter, Helvetica, sans-serif'
            },
            tech: {
                bgColor: '#0F766E',
                textColor: '#FFFFFF',
                titleColor: '#FFFFFF',
                bulletColor: '#14B8A6',
                titleSize: 32,
                textSize: 20,
                font: 'Inter, Consolas, monospace'
            },
            strategic: {
                bgColor: '#0D47A1',
                textColor: '#FFFFFF',
                titleColor: '#FFFFFF',
                bulletColor: '#424242',
                titleSize: 32,
                textSize: 20,
                font: 'Inter, Roboto, sans-serif'
            },
            crypto: {
                bgColor: '#0f0c29',
                textColor: '#FFFFFF',
                titleColor: '#FFFFFF',
                bulletColor: '#302b63',
                titleSize: 32,
                textSize: 20,
                font: 'Inter, Orbitron, sans-serif'
            }
        };

        // Event Listeners
        multimediaUpload.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileUpload);
        addUrlBtn.addEventListener('click', handleUrlAdd);
        generateBtn.addEventListener('click', generatePresentation);
        prevSlideBtn.addEventListener('click', showPrevSlide);
        nextSlideBtn.addEventListener('click', showNextSlide);
        downloadPptBtn.addEventListener('click', downloadPresentationPPT);
        downloadPdfBtn.addEventListener('click', downloadPresentationPDF);
        downloadHtmlBtn.addEventListener('click', downloadPresentationHTML);

        templateItems.forEach(item => {
            item.addEventListener('click', () => {
                templateItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
            });
        });

        aiOptions.forEach(option => {
            option.addEventListener('click', () => {
                aiOptions.forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                state.selectedAI = option.dataset.ai;
            });
        });

        // Functions
        function handleFileUpload(e) {
            const files = e.target.files;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                let type = 'image';

                if (file.type.startsWith('video/')) type = 'video';
                else if (file.type.startsWith('audio/')) type = 'audio';

                const reader = new FileReader();
                reader.onload = (event) => {
                    state.multimediaResources.push({
                        type: type,
                        source: event.target.result,
                        name: file.name,
                        id: 'media-' + Date.now() + Math.random().toString(36).substr(2, 5)
                    });
                    updateMultimediaPreview();
                };
                reader.readAsDataURL(file);
            }
        }

        function handleUrlAdd() {
            const url = mediaUrlInput.value.trim();
            if (!url) return;

            let type = 'image';
            if (url.match(/\.(mp4|webm|ogg|mov)$/i)) type = 'video';
            else if (url.match(/\.(mp3|wav|ogg)$/i)) type = 'audio';
            else if (url.match(/youtube\.com|youtu\.be/i)) type = 'youtube';

            state.multimediaResources.push({
                type: type,
                source: url,
                name: url.substring(url.lastIndexOf('/') + 1),
                id: 'url-' + Date.now() + Math.random().toString(36).substr(2, 5)
            });

            updateMultimediaPreview();
            mediaUrlInput.value = '';
        }

        function updateMultimediaPreview() {
            multimediaPreview.innerHTML = '';
            state.multimediaResources.forEach(resource => {
                const preview = document.createElement('div');
                preview.classList.add('preview-item', resource.type);

                if (resource.type === 'image') {
                    preview.style.backgroundImage = `url(${resource.source})`;
                } else {
                    preview.style.backgroundColor = '#6a5acd';
                }

                const removeBtn = document.createElement('div');
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.style.position = 'absolute';
                removeBtn.style.top = '5px';
                removeBtn.style.right = '5px';
                removeBtn.style.cursor = 'pointer';
                removeBtn.style.color = 'white';
                removeBtn.style.backgroundColor = 'rgba(0,0,0,0.5)';
                removeBtn.style.borderRadius = '50%';
                removeBtn.style.width = '20px';
                removeBtn.style.height = '20px';
                removeBtn.style.display = 'flex';
                removeBtn.style.justifyContent = 'center';
                removeBtn.style.alignItems = 'center';

                removeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const index = state.multimediaResources.findIndex(r => r.id === resource.id);
                    if (index !== -1) {
                        state.multimediaResources.splice(index, 1);
                        updateMultimediaPreview();
                    }
                });

                preview.appendChild(removeBtn);
                multimediaPreview.appendChild(preview);
            });
        }

        async function generatePresentation() {
            try {
                // Get input values
                const title = document.getElementById('presentation-title').value;
                const topic = document.getElementById('presentation-topic').value;
                const slideCount = parseInt(document.getElementById('slide-count').value);
                const style = document.querySelector('.template-item.active')?.dataset.style || 'professional';

                // Show loading state
                generatingOverlay.classList.remove('hidden');
                generateBtn.disabled = true;
                apiStatus.textContent = "Connecting to AI service...";

                // Generate detailed prompt
                const prompt = `Create a ${slideCount}-slide presentation about "${title}". 
    Detailed topic: "${topic}". 
    Style: ${style}. 
    Return ONLY valid JSON with this structure: 
    {
        "title": "Presentation Title",
        "slides": [
            {
                "title": "Slide Title",
                "content": ["Bullet point 1", "Bullet point 2"],
                "media_suggestion": "image/video/none"
            }
        ]
    }`;

                // Select API based on user choice
                const endpoint = state.selectedAI === 'claude' ? API_ENDPOINTS.CLAUDE : API_ENDPOINTS.GEMINI;

                // Build request body with CORRECT model names
                const requestBody = state.selectedAI === 'claude' ?
                    {
                        model: "claude-3-haiku-20240307",
                        max_tokens: 2000,
                        temperature: 0.7,
                        messages: [{
                            role: "user",
                            content: prompt
                        }]
                    } :
                    {
                        model: "gemini-1.0-pro",  // Default model that works with v1 API
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 2000
                        }
                    };

                // Log request for debugging
                console.log('API Endpoint:', endpoint);
                console.log('Request Body:', JSON.stringify(requestBody, null, 2));

                // Update status
                apiStatus.textContent = `Sending request to ${state.selectedAI.toUpperCase()}...`;

                // Call API with proper headers
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                // Enhanced error handling
                if (!response.ok) {
                    let errorDetails = '';
                    try {
                        const errorResponse = await response.json();
                        errorDetails = JSON.stringify(errorResponse);
                    } catch (e) {
                        errorDetails = await response.text();
                    }

                    console.error('API Error:', response.status, errorDetails);
                    throw new Error(`API request failed: ${response.status} - ${errorDetails.slice(0, 100)}`);
                }

                // Process response
                apiStatus.textContent = "Processing AI response...";
                const data = await response.json();
                console.log('API Response:', data);

                // Extract response text based on AI provider
                let responseText = '';
                if (state.selectedAI === 'claude') {
                    // Claude response format
                    responseText = data.content[0].text;
                } else {
                    // Gemini response format (multiple possible structures)
                    responseText = data.candidates?.[0]?.content?.parts?.[0]?.text ||
                        data.contents?.[0]?.parts?.[0]?.text ||
                        data.text ||
                        data.output ||
                        "";
                }

                if (!responseText) {
                    console.error('Empty response from AI. Full response:', data);
                    throw new Error("Empty response from AI");
                }

                state.presentationData = processAIResponse(responseText, title, slideCount, style);
                updateUI();

            } catch (error) {
                console.error('Generation Error:', error);
                showError('Generation Failed', error.message, error.stack || '');
            } finally {
                generatingOverlay.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        function processAIResponse(response, title, slideCount, style) {
            try {
                // Extract JSON from response
                const jsonStart = response.indexOf('{');
                const jsonEnd = response.lastIndexOf('}') + 1;
                const jsonString = response.substring(jsonStart, jsonEnd);
                const aiData = JSON.parse(jsonString);

                // Validate and process slides
                if (!aiData.slides || !Array.isArray(aiData.slides)) {
                    throw new Error('Invalid slide data in AI response');
                }

                const slides = aiData.slides.map((slide, index) => {
                    if (!slide.title || !slide.content) {
                        throw new Error(`Invalid slide at index ${index}`);
                    }

                    // Determine slide type based on position
                    let slideType = "content";
                    if (index === 0) slideType = "title";
                    else if (index === aiData.slides.length - 1) slideType = "conclusion";
                    else if (index % 3 === 0) slideType = "section-header";

                    // Assign media resource
                    let media = null;
                    if (slide.media_suggestion && slide.media_suggestion !== "none" &&
                        state.multimediaResources.length > 0) {
                        const mediaIndex = index % state.multimediaResources.length;
                        media = state.multimediaResources[mediaIndex];
                    }

                    return {
                        title: slide.title,
                        content: Array.isArray(slide.content) ? slide.content : [slide.content],
                        type: slideType,
                        style: style,
                        media: media
                    };
                });

                return {
                    title: title,
                    slides: slides,
                    style: style,
                    generatedAt: new Date()
                };
            } catch (e) {
                console.error('Error processing AI response:', e);
                throw new Error('Invalid response format from AI: ' + e.message);
            }
        }

        function updateUI() {
            if (!state.presentationData || !state.presentationData.slides.length) {
                showError('Presentation Error', 'No slides were generated');
                return;
            }

            state.generatedSlides = state.presentationData.slides;
            state.currentSlideIndex = 0;

            // Update slide counters
            totalSlidesEl.textContent = state.generatedSlides.length;
            currentSlideEl.textContent = state.currentSlideIndex + 1;

            // Enable navigation buttons
            prevSlideBtn.disabled = false;
            nextSlideBtn.disabled = state.generatedSlides.length <= 1;

            // Show slide container
            previewPlaceholder.classList.add('hidden');
            slideContainer.classList.remove('hidden');

            // Show first slide
            updateSlideDisplay();
        }

        function updateSlideDisplay() {
            if (state.generatedSlides.length === 0) return;

            const slide = state.generatedSlides[state.currentSlideIndex];
            const style = styleTemplates[slide.style] || styleTemplates.professional;
            slideContent.innerHTML = '';
            slideMedia.innerHTML = '';

            // Set slide background
            slideContent.style.backgroundColor = style.bgColor;
            slideContent.style.color = style.textColor;
            slideContent.style.fontFamily = style.font;
            slideContent.style.padding = '40px';

            // Add title
            const titleEl = document.createElement('div');
            titleEl.className = 'slide-title';
            titleEl.textContent = slide.title;
            titleEl.style.color = style.titleColor;
            titleEl.style.fontSize = style.titleSize + 'px';
            slideContent.appendChild(titleEl);

            // Add content
            slide.content.forEach(point => {
                const contentEl = document.createElement('div');
                contentEl.className = 'slide-bullet';
                contentEl.textContent = point;
                contentEl.style.fontSize = style.textSize + 'px';
                slideContent.appendChild(contentEl);
            });

            // Add media to slide
            if (slide.media) {
                if (slide.media.type === 'image') {
                    const img = document.createElement('img');
                    img.src = slide.media.source;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '50%';
                    img.style.marginTop = '20px';
                    img.style.borderRadius = '8px';
                    slideContent.appendChild(img);
                } else if (slide.media.type === 'video') {
                    const video = document.createElement('video');
                    video.src = slide.media.source;
                    video.controls = true;
                    video.style.maxWidth = '100%';
                    video.style.maxHeight = '50%';
                    video.style.marginTop = '20px';
                    video.style.borderRadius = '8px';
                    slideContent.appendChild(video);
                } else if (slide.media.type === 'audio') {
                    const audio = document.createElement('audio');
                    audio.src = slide.media.source;
                    audio.controls = true;
                    audio.style.width = '100%';
                    audio.style.marginTop = '20px';
                    slideContent.appendChild(audio);
                } else if (slide.media.type === 'youtube') {
                    const videoId = extractYouTubeId(slide.media.source);
                    if (videoId) {
                        const iframe = document.createElement('iframe');
                        iframe.src = `https://www.youtube.com/embed/${videoId}`;
                        iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                        iframe.allowFullscreen = true;
                        iframe.style.width = '100%';
                        iframe.style.height = '300px';
                        iframe.style.marginTop = '20px';
                        iframe.style.borderRadius = '8px';
                        slideContent.appendChild(iframe);
                    }
                }
            }

            // Add footer
            const footer = document.createElement('div');
            footer.style.position = 'absolute';
            footer.style.bottom = '20px';
            footer.style.right = '20px';
            footer.style.fontSize = '14px';
            footer.textContent = `Slide ${state.currentSlideIndex + 1} of ${state.generatedSlides.length}`;
            slideContent.appendChild(footer);

            // Update slide counter
            currentSlideEl.textContent = state.currentSlideIndex + 1;

            // Update navigation buttons
            prevSlideBtn.disabled = state.currentSlideIndex === 0;
            nextSlideBtn.disabled = state.currentSlideIndex === state.generatedSlides.length - 1;
        }

        function showError(title, message, details = '') {
            errorMessage.textContent = message;
            errorDetails.textContent = details || message;
            errorPanel.style.display = 'block';

            // Scroll to error
            errorPanel.scrollIntoView({ behavior: 'smooth' });
        }

        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function showPrevSlide() {
            if (state.currentSlideIndex > 0) {
                state.currentSlideIndex--;
                updateSlideDisplay();
            }
        }

        function showNextSlide() {
            if (state.currentSlideIndex < state.generatedSlides.length - 1) {
                state.currentSlideIndex++;
                updateSlideDisplay();
            }
        }

        function downloadPresentationPPT() {
            if (!state.presentationData || state.generatedSlides.length === 0) {
                showError('Export Error', 'Please generate a presentation first!');
                return;
            }

            // Create a new presentation
            const pptx = new PptxGenJS();
            pptx.author = "AI Presentation Generator";
            pptx.title = state.presentationData.title;
            pptx.company = "AI Presentation Tools";

            // Set layout for all slides
            pptx.layout = 'LAYOUT_16x9';

            // Add slides with proper positioning
            state.presentationData.slides.forEach((slide, index) => {
                const style = styleTemplates[slide.style] || styleTemplates.professional;
                const pptxSlide = pptx.addSlide();

                // Set background
                pptxSlide.background = { color: style.bgColor };

                // Add title with proper positioning
                pptxSlide.addText(slide.title, {
                    x: slide.type === "title" ? 0 : 0.5,
                    y: slide.type === "title" ? 1.5 : 0.5,
                    w: slide.type === "title" ? '100%' : '90%',
                    h: 1.5,
                    fontSize: style.titleSize,
                    bold: true,
                    color: style.titleColor,
                    fontFace: style.font,
                    align: slide.type === "title" ? "center" : "left"
                });

                // Add content with proper positioning
                let yPos = slide.type === "title" ? 3.0 : 1.5;
                slide.content.forEach((point) => {
                    pptxSlide.addText(point, {
                        x: slide.type === "title" ? 0.5 : 1.0,
                        y: yPos,
                        w: slide.type === "title" ? '90%' : '85%',
                        fontSize: style.textSize,
                        color: style.textColor,
                        fontFace: style.font,
                        align: slide.type === "title" ? "center" : "left",
                        bullet: slide.type === "title" ? false : {
                            code: "25CF",
                            color: style.bulletColor
                        }
                    });
                    yPos += 0.6; // Increment vertical position
                });

                // Add footer
                pptxSlide.addText(`Slide ${index + 1} of ${state.presentationData.slides.length}`, {
                    x: 7.0,
                    y: 6.5,
                    w: 2.0,
                    fontSize: 12,
                    color: style.textColor,
                    fontFace: style.font
                });

                // Add logo for title slide
                if (slide.type === "title") {
                    pptxSlide.addText("AI Presentation Generator", {
                        x: "50%",
                        y: 6.0,
                        w: "100%",
                        fontSize: 18,
                        color: style.textColor,
                        fontFace: style.font,
                        align: "center"
                    });
                }

                // Add media to slide (images only for PPTX)
                if (slide.media && slide.media.type === 'image') {
                    try {
                        pptxSlide.addImage({
                            data: slide.media.source,
                            x: 5.0,
                            y: 2.0,
                            w: 3.0,
                            h: 3.0
                        });
                    } catch (e) {
                        console.error("Error adding image to slide:", e);
                    }
                }
            });

            // Download the presentation
            pptx.writeFile({
                fileName: `${state.presentationData.title.replace(/[^a-z0-9]/gi, '_')}.pptx`
            })
                .then(() => {
                    // Show notification
                    saveNotification.classList.add('show');
                    setTimeout(() => saveNotification.classList.remove('show'), 5000);
                })
                .catch(err => {
                    console.error("Error generating PPTX:", err);
                    showError('Export Error', 'Failed to generate presentation file. Please try again.');
                });
        }

        function downloadPresentationPDF() {
            showError('Coming Soon', 'PDF export will be available in the next version. For now, please use the PPTX export.');
        }

        function downloadPresentationHTML() {
            showError('Coming Soon', 'HTML export will be available in the next version. For now, please use the PPTX export.');
        }

        // Initialize
        totalSlidesEl.textContent = "0";
        currentSlideEl.textContent = "0";
    </script>
</body>

</html>